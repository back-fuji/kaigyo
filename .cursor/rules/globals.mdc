---
alwaysApply: true
---
# 2. Flutter ベストプラクティスの強制
- const を使える箇所には必ず const を付ける。
- async/await を使用し、then チェーンは禁止。
- 状態管理は後にユーザーが選択した方式に“自動で揃える”こと。
  - 推測で Provider / Riverpod など決めない。
- UI ロジックとビジネスロジックは必ず分離する。

---
# 3. ファイル構成ポリシー（まだフォルダが無くても適用される）
AI がコード生成するときのデフォルト構成は次の通りとする：

lib/
core/ → 定数・例外・テーマ・ユーティリティ
features/ → 各機能（feature）ごとのモジュール
<feature>/ → 1つの機能（画面やユースケース）をまとめたディレクトリ
shared/ → 共通Widget・共通サービス
各 feature ディレクトリは必ず次の4 層で構造化する：
lib/features/<feature>/
presentation/ → UI（Widget）
application/ → state, usecase（アプリケーションロジック）
domain/ → entity, repository interface（ドメインロジック）
infrastructure/ → API 実装・外部サービスとの接続

- AI はこれに反する構造を絶対に作らない。
- AI はこの構造に従ってファイル生成・配置を行う。
- 新しい feature を作る場合は、必ず上記4 層構造を前提とする。

---

# 4. ファイル生成ルール（必ず理由を説明）
- AI が新規ファイルを作る場合は「なぜ必要か」を説明すること。
- 利用者が求めていないファイル作成は禁止。
- 不必要なリネームや移動は禁止。

---

# 5. import 操作の安全ルール
- 未使用に見える import を AI が勝手に削除しない。
- 削除提案する場合は理由を説明し、同意がある場合のみ削除する。

---

# 6. 命名規約（AI が自律的に担保する）
- クラス名：PascalCase
- ファイル名：snake_case
- private メソッド：_camelCase
- Widget 名は UI の役割が推測可能な名前にする
- 意味のない短縮（Cntr, Hldr 等）は禁止

---

# 7. コメント・ドキュメント
- public メソッド・public クラスには必ず DartDoc (///) を付与する。
- 役割・入出力・例外・依存関係を明記する。
- 難しい処理には一行コメントを添える。

---

# 8. アーキテクチャガード（PJの一貫性を守る）
- プレゼンテーション層は domain や infra に直接依存しない。
- 依存方向は **UI → application → domain → infrastructure** の一方向のみ。
- ビジネスロジックを Widget 内に書いてはならない。
- AI は構造を壊すような提案を一切行わない。

---

# 9. コード整形ルール
- インデント・改行は構造を壊さない範囲でのみ最小限整形する。
- 自動で大幅整形は禁止。

---

# 10. AI の回答方針（説明・コード生成時）
AI は以下の順序で説明・提案する：

1. **目的の明確化**
2. **最適アーキテクチャでの位置づけ**
3. **生成するコードの構造説明**
4. **依存関係の説明**
5. **コード提示**
6. **次に必要になるファイルの提案（任意・強制しない）**

---

# 11. 禁止事項
AI は以下を絶対に行わない：

- 推測で状態管理方式を決める
- 推測でテーマ・色・UI デザインを変更する
- 自動リファクタリング（名前変更・関数分割など）を勝手に行う
- 大量ファイルの一括変更
- Flutter 推奨外の書き方を行う
- あいまいな説明や曖昧な推測

---

# 12. 今後ユーザーが提示する仕様書は最優先で遵守する
- 仕様変更があった場合、これらのルールよりも優先する。
- AI は仕様の矛盾を指摘しながら整合性を維持する。

---

# 13. プラットフォーム固有ファイルの編集禁止
- AI は android/, ios/, macos/, windows/, linux/, web/ ディレクトリ内のファイルを、
  勝手に編集してはならない。
- build.gradle, Info.plist, Podfile などの設定系ファイルも、
  勝手に編集してはならない。要求に対して必要な場合に説明し編集を加える。

---

# 14. pubspec.yaml の取り扱い
- AI は pubspec.yaml の依存関係を勝手に追加・削除してはならない。
- 新しいパッケージを追加する際は、理由と用途を説明し、ユーザーの許可を得てから行う。

# 本ファイルはこのプロジェクトにおける AI 挙動の最優先ルールとする。